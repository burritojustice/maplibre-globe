<!DOCTYPE html> 
<html lang="en">
<head>
    <title>Hide and Seek</title>
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel='stylesheet' href='https://unpkg.com/maplibre-gl@5.16.0/dist/maplibre-gl.css' />
    <script src='https://unpkg.com/maplibre-gl@5.16.0/dist/maplibre-gl.js'></script>
    <style>
        body { margin: 0; padding: 0; }
        html, body, #map { height: 100%; }
    </style>
</head>
<body>
<div id="map"></div>
<script>
    // Parse URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const hideParam = urlParams.get('hide');
    const showParam = urlParams.get('show');
    
    // Set default values or use URL parameters
    const countriesToHide = hideParam ? hideParam.split(',').map(c => c.trim()) : ['GRL'];
    const countriesToShow = showParam ? showParam.split(',').map(c => c.trim()) : ['USA', 'CHN', 'RUS', 'BLR', 'PRK', 'HUN'];
    
    // Determine if we have URL parameters
    const hasUrlParams = hideParam || showParam;
    const hasOnlyHide = hideParam && !showParam;
    const hasOnlyShow = showParam && !hideParam;
    
    const map = new maplibregl.Map({
        container: 'map',
        style: 'https://demotiles.maplibre.org/style.json',
        zoom: 1.5,
        center: [-62.1, 61.7],
        maxZoom: 3
    });
    
    map.on('style.load', () => {
        map.setProjection({
            type: 'globe',
        });
        
        // Override to always show full country names
        map.setLayoutProperty('countries-label', 'text-field', ['get', 'NAME']);
        
        // Only show labels at zoom 4 and above
        map.setLayerZoomRange('countries-label', 3, 24);
        
        let codeToAbbrev = {};
        let hideActive = false;
        let showActive = false;
        let selectedCountries = new Set();
        
        // Add a layer for selected country outlines
        map.addSource('selected-countries', {
            type: 'geojson',
            data: {
                type: 'FeatureCollection',
                features: []
            }
        });
        
        map.addLayer({
            id: 'selected-countries-outline',
            type: 'line',
            source: 'selected-countries',
            paint: {
                'line-color': '#ff0000',
                'line-width': {
                    'stops': [
                        [1, 1],
                        [6, 2],
                        [14, 6],
                        [22, 12]
                    ]
                }
            }
        });
        
        // Function to update selected countries outline
        function updateSelectedOutline() {
            if (selectedCountries.size === 0) {
                map.getSource('selected-countries').setData({
                    type: 'FeatureCollection',
                    features: []
                });
                return;
            }
            
            // Query all rendered features from the countries layer
            const features = map.queryRenderedFeatures({
                layers: ['countries-boundary']
            }).filter(feature => selectedCountries.has(feature.properties.ADM0_A3));
            
            console.log('Selected features for outline:', features.length);
            
            if (features.length > 0) {
                map.getSource('selected-countries').setData({
                    type: 'FeatureCollection',
                    features: features
                });
            }
        }
        
        // Function to hide specific countries
        function hideCountries(countryList) {
            const layersToFilter = ['countries-fill', 'countries-boundary', 'coastline'];
            const filter = ['all', ['!', ['in', ['get', 'ADM0_A3'], ['literal', countryList]]]];
            
            layersToFilter.forEach(layerId => {
                map.setFilter(layerId, filter);
            });
            
            const abbrevsToHide = countryList.map(code => codeToAbbrev[code]).filter(Boolean);
            
            map.setFilter('countries-label', [
                'all',
                ['!', ['in', ['get', 'ABBREV'], ['literal', abbrevsToHide]]]
